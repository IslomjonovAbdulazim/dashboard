import{r as p,f as I,t as w,j as e,B as c,u as ce}from"./index-BgyDtNiv.js";import{u as F}from"./useQuery-CgxBcApU.js";import{u as G,a as J,I as O}from"./input-v00MU9y0.js";import{S as V,a as K,b as Q,c as U,d as E}from"./select-DfqUIn-H.js";import{B as z}from"./badge-CfInFiFo.js";import{A as de,a as me,b as xe,H as he,S as ue,T as je,C as pe,P as ge}from"./config-drawer-CPqw4M9g.js";import{T as fe,M as Ce}from"./top-nav-CV4kcU2N.js";import{f as Ne,a as _,C as ve,g as be,D as we}from"./schema-CFTLwjEk.js";import{l as H,g as ye}from"./media-utils-DwH0f5r5.js";import{u as $,F as X,a as f,b as C,c as N,d as v,e as b,S as Y,E as Se,T as De}from"./form-C5osUfP1.js";import{j as Z,p as Le,k as ee,l as se,m as re,n as ae,o as ne,D as Te,e as Fe,f as Ee,g as _e,i as A,h as Ae}from"./dropdown-menu-CbyZjeZg.js";import{T as te}from"./textarea-B-nCCrlR.js";import{B as le,s as R,U as qe}from"./sidebar-BuvVQDyf.js";import{C as q,a as M,b as k,c as B,d as P}from"./card-v1uoEE92.js";import{T as Me,a as ke,b as W,c as D,d as Be,e as L}from"./table-BGrjgXTT.js";import{C as Pe}from"./index-Vj7zbINv.js";import{C as Ie}from"./calendar-Ebjbju67.js";import{E as Oe}from"./eye-Ctr-FVRM.js";import{P as Ve}from"./plus-BRxX29p4.js";import"./createLucideIcon-CVShTzUI.js";import"./chevron-down-C2cc_PuL.js";import"./zehnly-auth-api-1g0FtGCR.js";import"./api-D_rfR1zQ.js";import"./label-DUPVReW0.js";function Ke({children:t,onSuccess:g}){const[d,m]=p.useState(!1),x=I(),a=G({resolver:J(Ne),defaultValues:{title:"",description:""}}),{data:u,isLoading:i}=F({queryKey:["learning-centers"],queryFn:()=>H.list()}),o=$({mutationFn:s=>_.courses.create(s),onSuccess:()=>{w.success("Course created successfully"),x.invalidateQueries({queryKey:["courses"]}),a.reset(),m(!1),g?.()},onError:s=>{w.error("Failed to create course"),console.error("Create course error:",s)}}),h=s=>{o.mutate(s)};return e.jsxs(Z,{open:d,onOpenChange:m,children:[e.jsx(Le,{asChild:!0,children:t||e.jsxs(c,{children:[e.jsx(ve,{className:"h-4 w-4"}),"Add Course"]})}),e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Create New Course"]}),e.jsx(ae,{children:"Add a new course to manage lessons and educational content."})]}),e.jsx(X,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(h),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(f,{control:a.control,name:"title",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Course Title *"}),e.jsx(v,{children:e.jsx(O,{placeholder:"e.g., English Basics",...s})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"description",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Description"}),e.jsx(v,{children:e.jsx(te,{placeholder:"Brief description of the course content and objectives...",className:"min-h-[100px]",...s})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"learning_center_id",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Learning Center *"}),e.jsxs(V,{onValueChange:n=>s.onChange(parseInt(n)),value:s.value?.toString(),disabled:i,children:[e.jsx(v,{children:e.jsx(K,{children:e.jsx(Q,{placeholder:"Select a learning center"})})}),e.jsx(U,{children:u?.map(n=>e.jsx(E,{value:n.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.is_active?"bg-green-500":"bg-red-500"}`}),n.name]})},n.id))})]}),e.jsx(b,{})]})})]}),e.jsxs(ne,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:o.isPending,className:"min-w-[100px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Course"})]})]})})]})]})}function Qe({course:t,open:g,onOpenChange:d,onSuccess:m}){const x=I(),a=G({resolver:J(be),defaultValues:{title:"",description:""}}),{data:u,isLoading:i}=F({queryKey:["learning-centers"],queryFn:()=>H.list()}),o=$({mutationFn:s=>{if(!t)throw new Error("No course selected");return _.courses.update(t.id,s)},onSuccess:()=>{w.success("Course updated successfully"),x.invalidateQueries({queryKey:["courses"]}),d(!1),m?.()},onError:s=>{w.error("Failed to update course"),console.error("Update course error:",s)}});p.useEffect(()=>{t&&a.reset({title:t.title,description:t.description||"",learning_center_id:t.learning_center_id})},[t,a]);const h=s=>{o.mutate(s)};return t?e.jsx(Z,{open:g,onOpenChange:d,children:e.jsxs(ee,{className:"sm:max-w-[600px]",children:[e.jsxs(se,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Edit Course"]}),e.jsx(ae,{children:"Update the course information and settings."})]}),e.jsx(X,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(h),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(f,{control:a.control,name:"title",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Course Title *"}),e.jsx(v,{children:e.jsx(O,{placeholder:"e.g., English Basics",...s})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"description",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Description"}),e.jsx(v,{children:e.jsx(te,{placeholder:"Brief description of the course content and objectives...",className:"min-h-[100px]",...s})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"learning_center_id",render:({field:s})=>e.jsxs(C,{children:[e.jsx(N,{children:"Learning Center *"}),e.jsxs(V,{onValueChange:n=>s.onChange(parseInt(n)),value:s.value?.toString(),disabled:i,children:[e.jsx(v,{children:e.jsx(K,{children:e.jsx(Q,{placeholder:"Select a learning center"})})}),e.jsx(U,{children:u?.map(n=>e.jsx(E,{value:n.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.is_active?"bg-green-500":"bg-red-500"}`}),n.name]})},n.id))})]}),e.jsx(b,{})]})})]}),e.jsxs(ne,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:o.isPending,className:"min-w-[100px]",children:o.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Course"})]})]})})]})}):null}function Ue({data:t,learningCenters:g,isLoading:d,onEdit:m,onViewLessons:x,onRefresh:a}){const[u,i]=p.useState(!1),[o,h]=p.useState(null),s=I(),n=$({mutationFn:r=>_.courses.delete(r),onSuccess:r=>{w.success(r.message),s.invalidateQueries({queryKey:["courses"]}),a(),i(!1),h(null)},onError:r=>{w.error("Failed to delete course"),console.error("Delete error:",r)}}),y=r=>{h(r),i(!0)},T=()=>{o&&n.mutate(o.id)};return d?e.jsxs(q,{children:[e.jsxs(M,{children:[e.jsx(k,{children:"Courses"}),e.jsx(B,{children:"Loading..."})]}),e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):t.length===0?e.jsxs(q,{children:[e.jsxs(M,{children:[e.jsx(k,{children:"Courses"}),e.jsx(B,{children:"No courses found"})]}),e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No courses have been created yet.",e.jsx("br",{}),'Click "Add Course" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(M,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),"Courses (",t.length,")"]}),e.jsx(B,{className:"mt-1",children:"Manage educational courses and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Lessons"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.reduce((r,j)=>r+(j.lessons_count||0),0)})]})]})}),e.jsx(P,{children:e.jsxs(Me,{children:[e.jsx(ke,{children:e.jsxs(W,{children:[e.jsx(D,{children:"Course"}),e.jsx(D,{children:"Learning Center"}),e.jsx(D,{children:"Lessons"}),e.jsx(D,{children:"Created"}),e.jsx(D,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Be,{children:t.map(r=>e.jsxs(W,{children:[e.jsx(L,{className:"max-w-[350px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:r.title,children:r.title}),r.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",title:r.description,children:r.description})]})}),e.jsx(L,{className:"max-w-[200px]",children:(()=>{const j=g.find(S=>S.id===r.learning_center_id);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(de,{className:"h-8 w-8",children:[e.jsx(me,{src:ye(j?.logo||null),alt:j?.name}),e.jsx(xe,{children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("div",{className:"font-medium text-sm truncate",title:j?.name||`Center ${r.learning_center_id}`,children:j?.name||`Center ${r.learning_center_id}`})})]})})()}),e.jsx(L,{children:e.jsx(c,{variant:"ghost",size:"sm",className:"h-auto p-1 hover:bg-muted/50",onClick:()=>x(r),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Lessons"})]})})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ie,{className:"h-3 w-3"}),new Date(r.created_at).toLocaleDateString()]})}),e.jsx(L,{children:e.jsxs(Te,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(c,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Se,{className:"h-4 w-4"})]})}),e.jsxs(Ee,{align:"end",children:[e.jsx(_e,{children:"Actions"}),e.jsxs(A,{onClick:()=>x(r),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"View Lessons"]}),e.jsx(Ae,{}),e.jsxs(A,{onClick:()=>m(r),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(A,{onClick:()=>y(r),className:"text-red-600",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},r.id))})]})})]}),e.jsx(Pe,{open:u,onOpenChange:i,title:"Delete Course",desc:`Are you sure you want to delete "${o?.title}"? This action cannot be undone and will also delete all associated lessons and words.`,confirmText:"Delete",handleConfirm:T,isLoading:n.isPending})]})}function He(){const t=ce(),[g,d]=p.useState(null),[m,x]=p.useState(!1),[a,u]=p.useState(""),[i,o]=p.useState("all"),{data:h=[],isLoading:s,refetch:n}=F({queryKey:["courses"],queryFn:()=>_.courses.list()}),{data:y=[]}=F({queryKey:["learning-centers"],queryFn:()=>H.list()}),T=h.filter(l=>{const ie=l.title.toLowerCase().includes(a.toLowerCase())||l.description?.toLowerCase().includes(a.toLowerCase()),oe=i==="all"||l.learning_center_id.toString()===i;return ie&&oe}),r=l=>{d(l),x(!0)},j=l=>{t({to:"/content/lessons",search:{courseId:l.id}})},S=()=>{n()};return e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsx(fe,{links:$e}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(ue,{}),e.jsx(je,{}),e.jsx(pe,{}),e.jsx(ge,{})]})]}),e.jsxs(Ce,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Course Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Create and manage educational courses across all learning centers"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(Ke,{onSuccess:S,children:e.jsxs(c,{size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Ve,{className:"mr-2 h-5 w-5"}),"Add Course"]})})})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(O,{placeholder:"Search courses...",value:a,onChange:l=>u(l.target.value),className:"w-full"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{value:i,onValueChange:o,children:[e.jsx(K,{className:"w-[160px]",children:e.jsx(Q,{placeholder:"All Centers"})}),e.jsxs(U,{children:[e.jsx(E,{value:"all",children:"All Centers"}),y.map(l=>e.jsx(E,{value:l.id.toString(),children:l.name},l.id))]})]}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"h-4 w-4"}),"Export"]})]})]}),(a||i!=="all")&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsxs("span",{children:["Showing ",T.length," of ",h.length," courses"]}),a&&e.jsxs(z,{variant:"secondary",children:['Search: "',a,'"']}),i!=="all"&&e.jsxs(z,{variant:"secondary",children:["Center: ",y.find(l=>l.id.toString()===i)?.name]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{u(""),o("all")},children:"Clear filters"})]}),e.jsx(Ue,{data:T,learningCenters:y,isLoading:s,onEdit:r,onViewLessons:j,onRefresh:S})]}),e.jsx(Qe,{course:g,open:m,onOpenChange:x,onSuccess:S})]})}const $e=[{title:"Courses",href:"/content/courses",isActive:!0,disabled:!1},{title:"Lessons",href:"/content/lessons",isActive:!1,disabled:!1},{title:"Words",href:"/content/words",isActive:!1,disabled:!1}],ps=He;export{ps as component};

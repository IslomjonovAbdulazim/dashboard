import{o as G,h as $,s as I,l as ie,f as O,r as o,t as d,j as e,B as y}from"./index-BgyDtNiv.js";import{u as Q,a as _,I as b}from"./input-v00MU9y0.js";import{u as q,F as H,a as p,b as x,c as h,d as g,e as j,S as J,E as oe,T as ce}from"./form-C5osUfP1.js";import{j as W,p as de,k as X,l as Y,m as Z,n as ee,X as se,o as te,D as ue,e as me,f as pe,g as xe,i as R,h as he}from"./dropdown-menu-CbyZjeZg.js";import{T as re}from"./textarea-B-nCCrlR.js";import{S as ae}from"./switch-tVXKj20j.js";import{a as F}from"./api-D_rfR1zQ.js";import{P as ge}from"./plus-BRxX29p4.js";import{U as ne,I as k}from"./upload-D8YRluLw.js";import{u as je}from"./useQuery-CgxBcApU.js";import{u as fe,D as we,g as ve,a as ye,b as be,c as Ne}from"./data-table-Dxm4uEro.js";import{B as Ce}from"./badge-CfInFiFo.js";import{C as K,d as V,a as Se,b as De}from"./card-v1uoEE92.js";import{u as Te,C as Ue}from"./index-Vj7zbINv.js";import{E as z}from"./external-link-Cqicd5cw.js";import{C as Pe}from"./calendar-Ebjbju67.js";import{E as Fe}from"./eye-Ctr-FVRM.js";import{f as Ee}from"./format-Dp3w_Y3x.js";import"./createLucideIcon-CVShTzUI.js";import"./label-DUPVReW0.js";import"./table-BGrjgXTT.js";import"./select-DfqUIn-H.js";import"./chevron-down-C2cc_PuL.js";import"./popover-B-EMkKqE.js";const E={list:async()=>(await F.get("/v1/popups")).data.data,get:async r=>(await F.get(`/v1/popups/${r}`)).data.data,create:async r=>(await F.post("/v1/popups",r)).data.data,update:async(r,c)=>(await F.put(`/v1/popups/${r}`,c)).data.data,delete:async r=>{await F.delete(`/v1/popups/${r}`)},uploadImage:async r=>{const c=new FormData;return c.append("file",r),(await F.post("/v1/file-upload/temp",c,{headers:{"Content-Type":"multipart/form-data"}})).data.data.url}},le=G({title:I().min(1,"Title is required").max(100,"Title must be less than 100 characters"),imageUrl:I().min(1,"Image is required").url("Must be a valid URL"),url:I().url("Must be a valid URL").optional().or(ie("")),description:I().optional(),buttonText:I().optional(),isActive:$()});G({isActive:$().optional()});function Me({children:r}){const c=O(),[f,v]=o.useState(!1),[u,w]=o.useState(null),[C,N]=o.useState(""),[D,T]=o.useState(!1),n=Q({resolver:_(le),defaultValues:{title:"",imageUrl:"",url:"",description:"",buttonText:"",isActive:!0}}),m=q({mutationFn:t=>E.create(t),onSuccess:()=>{c.invalidateQueries({queryKey:["popups"]}),d.success("Popup created successfully!"),v(!1),n.reset(),w(null),N("")},onError:t=>{const s=t.response?.data?.error||"Failed to create popup";d.error(s)}}),U=t=>{const s=t.target.files?.[0];if(s){if(!s.type.match(/^image\/(jpeg|jpg|png|webp)$/)){d.error("Please select a valid image file (JPG, PNG, WEBP)");return}if(s.size>10*1024*1024){d.error("File size must be less than 10MB");return}w(s);const a=new FileReader;a.onload=S=>{N(S.target?.result)},a.readAsDataURL(s)}},P=async()=>{if(!u)throw new Error("No file selected");T(!0);try{return await E.uploadImage(u)}finally{T(!1)}},M=async t=>{try{let s=t.imageUrl;if(u&&(s=await P()),!s){d.error("Please select an image");return}const a={title:t.title,imageUrl:s,url:t.url||void 0,description:t.description||void 0,buttonText:t.buttonText||void 0,isActive:t.isActive};m.mutate(a)}catch(s){d.error(s.message||"Failed to upload image")}},A=()=>{w(null),N(""),n.setValue("imageUrl","")};return e.jsxs(W,{open:f,onOpenChange:v,children:[e.jsx(de,{asChild:!0,children:r||e.jsxs(y,{children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Create Popup"]})}),e.jsxs(X,{className:"sm:max-w-[600px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Create New Popup"}),e.jsx(ee,{children:"Create a new popup with image and content settings."})]}),e.jsx(H,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-4",children:[e.jsx(p,{control:n.control,name:"title",render:({field:t})=>e.jsxs(x,{children:[e.jsx(h,{children:"Title"}),e.jsx(g,{children:e.jsx(b,{placeholder:"Summer Sale 2025",...t})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"imageUrl",render:({field:t})=>e.jsxs(x,{children:[e.jsx(h,{children:"Image"}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:U,className:"flex-1"}),e.jsx(y,{type:"button",variant:"outline",size:"icon",onClick:()=>document.querySelector('input[type="file"]')?.click(),children:e.jsx(ne,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:"or"}),e.jsx(b,{placeholder:"https://example.com/image.jpg",...t,disabled:!!u}),(C||t.value)&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full h-32 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center",children:[e.jsx("img",{src:C||t.value,alt:"Preview",className:"w-full h-full object-cover",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling?.classList.remove("hidden")}}),e.jsx(k,{className:"h-8 w-8 text-muted-foreground hidden"})]}),e.jsx(y,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-6 w-6",onClick:A,children:e.jsx(se,{className:"h-3 w-3"})})]})]})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"description",render:({field:t})=>e.jsxs(x,{children:[e.jsx(h,{children:"Description (Optional)"}),e.jsx(g,{children:e.jsx(re,{placeholder:"Get 50% off on all premium plans!",rows:3,...t})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{control:n.control,name:"url",render:({field:t})=>e.jsxs(x,{children:[e.jsx(h,{children:"URL (Optional)"}),e.jsx(g,{children:e.jsx(b,{placeholder:"https://example.com/sale",...t})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"buttonText",render:({field:t})=>e.jsxs(x,{children:[e.jsx(h,{children:"Button Text (Optional)"}),e.jsx(g,{children:e.jsx(b,{placeholder:"Shop Now",...t})}),e.jsx(j,{})]})})]}),e.jsx(p,{control:n.control,name:"isActive",render:({field:t})=>e.jsxs(x,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(h,{className:"text-base",children:"Active Status"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Enable this popup to show it to users"})]}),e.jsx(g,{children:e.jsx(ae,{checked:t.value,onCheckedChange:t.onChange})}),e.jsx(j,{})]})}),e.jsxs(te,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(y,{type:"submit",disabled:m.isPending||D,children:m.isPending||D?"Creating...":"Create Popup"})]})]})})]})]})}function Ae({popup:r,isOpen:c,onClose:f}){const v=O(),[u,w]=o.useState(null),[C,N]=o.useState(""),[D,T]=o.useState(!1),n=Q({resolver:_(le),defaultValues:{title:"",imageUrl:"",url:"",description:"",buttonText:"",isActive:!0}});o.useEffect(()=>{r&&(n.reset({title:r.title,imageUrl:r.imageUrl,url:r.url||"",description:r.description||"",buttonText:r.buttonText||"",isActive:r.isActive}),w(null),N(""))},[r,n]);const m=q({mutationFn:({id:s,data:a})=>E.update(s,a),onSuccess:()=>{v.invalidateQueries({queryKey:["popups"]}),d.success("Popup updated successfully!"),f()},onError:s=>{const a=s.response?.data?.error||"Failed to update popup";d.error(a)}}),U=s=>{const a=s.target.files?.[0];if(a){if(!a.type.match(/^image\/(jpeg|jpg|png|webp)$/)){d.error("Please select a valid image file (JPG, PNG, WEBP)");return}if(a.size>10*1024*1024){d.error("File size must be less than 10MB");return}w(a);const S=new FileReader;S.onload=L=>{N(L.target?.result)},S.readAsDataURL(a)}},P=async()=>{if(!u)throw new Error("No file selected");T(!0);try{return await E.uploadImage(u)}finally{T(!1)}},M=async s=>{if(r)try{let a=s.imageUrl;if(u&&(a=await P()),!a){d.error("Please select an image");return}const S={title:s.title,imageUrl:a,url:s.url||void 0,description:s.description||void 0,buttonText:s.buttonText||void 0,isActive:s.isActive};m.mutate({id:r._id,data:S})}catch(a){d.error(a.message||"Failed to upload image")}},A=()=>{w(null),N(""),n.setValue("imageUrl","")};if(!r)return null;const t=C||n.watch("imageUrl");return e.jsx(W,{open:c,onOpenChange:f,children:e.jsxs(X,{className:"sm:max-w-[600px]",children:[e.jsxs(Y,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Edit Popup"]}),e.jsx(ee,{children:"Update the popup settings. Changes will be applied immediately."})]}),e.jsx(H,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(M),className:"space-y-4",children:[e.jsx(p,{control:n.control,name:"title",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"Title"}),e.jsx(g,{children:e.jsx(b,{placeholder:"Summer Sale 2025",...s})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"imageUrl",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"Image"}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:U,className:"flex-1"}),e.jsx(y,{type:"button",variant:"outline",size:"icon",onClick:()=>document.querySelector('input[type="file"]')?.click(),children:e.jsx(ne,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:"or"}),e.jsx(b,{placeholder:"https://example.com/image.jpg",...s,disabled:!!u}),t&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full h-32 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center",children:[e.jsx("img",{src:t,alt:"Preview",className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextElementSibling?.classList.remove("hidden")}}),e.jsx(k,{className:"h-8 w-8 text-muted-foreground hidden"})]}),e.jsx(y,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-6 w-6",onClick:A,children:e.jsx(se,{className:"h-3 w-3"})})]})]})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"Description (Optional)"}),e.jsx(g,{children:e.jsx(re,{placeholder:"Get 50% off on all premium plans!",rows:3,...s})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{control:n.control,name:"url",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"URL (Optional)"}),e.jsx(g,{children:e.jsx(b,{placeholder:"https://example.com/sale",...s})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:"buttonText",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"Button Text (Optional)"}),e.jsx(g,{children:e.jsx(b,{placeholder:"Shop Now",...s})}),e.jsx(j,{})]})})]}),e.jsx(p,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(x,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(h,{className:"text-base",children:"Active Status"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Enable this popup to show it to users"})]}),e.jsx(g,{children:e.jsx(ae,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Popup Information"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Created: ",new Date(r.createdAt).toLocaleDateString()]}),e.jsxs("p",{children:["Last updated: ",new Date(r.updatedAt).toLocaleDateString()]})]})]}),e.jsxs(te,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:f,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:m.isPending||D,children:m.isPending||D?"Updating...":"Update Popup"})]})]})})]})})}function Ie({onEdit:r}){const c=O(),[f,v]=o.useState([]),[u,w]=o.useState([]),[C,N]=o.useState({}),[D,T]=o.useState({}),[n,m]=Te(!1),[U,P]=o.useState(null),{data:M=[],isLoading:A,error:t}=je({queryKey:["popups"],queryFn:E.list}),s=q({mutationFn:E.delete,onSuccess:()=>{c.invalidateQueries({queryKey:["popups"]}),d.success("Popup deleted successfully!"),m(!1),P(null)},onError:i=>{d.error(i.response?.data?.error||"Failed to delete popup")}}),a=o.useMemo(()=>[{accessorKey:"imageUrl",header:"Image",cell:({row:i})=>{const l=i.getValue("imageUrl");return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center",children:[l?e.jsx("img",{src:l,alt:"Popup",className:"w-full h-full object-cover",onError:B=>{B.currentTarget.style.display="none",B.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx(k,{className:"h-6 w-6 text-muted-foreground hidden"})]})})}},{accessorKey:"title",header:"Title",cell:({row:i})=>{const l=i.getValue("title");return e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("span",{className:"font-medium",children:l})})}},{accessorKey:"description",header:"Description",cell:({row:i})=>{const l=i.original.description;return e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-muted-foreground truncate",children:l||"No description"})})}},{accessorKey:"url",header:"URL",cell:({row:i})=>{const l=i.original.url;return e.jsx("div",{className:"flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline truncate max-w-32",children:l})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No URL"})})}},{accessorKey:"buttonText",header:"Button Text",cell:({row:i})=>{const l=i.original.buttonText;return e.jsx("span",{className:"text-sm",children:l||"No button text"})}},{accessorKey:"createdAt",header:"Created",cell:({row:i})=>{const l=new Date(i.getValue("createdAt"));return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:Ee(l,"MMM dd, yyyy")})]})}},{accessorKey:"isActive",header:"Status",cell:({row:i})=>{const l=i.getValue("isActive");return e.jsx(Ce,{variant:l?"default":"secondary",children:l?"Active":"Inactive"})}},{id:"actions",enableHiding:!1,cell:({row:i})=>{const l=i.original;return e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(y,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(oe,{className:"h-4 w-4"})]})}),e.jsxs(pe,{align:"end",children:[e.jsx(xe,{children:"Actions"}),l.imageUrl&&e.jsxs(R,{onClick:()=>window.open(l.imageUrl,"_blank"),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"View Image"]}),l.url&&e.jsxs(R,{onClick:()=>window.open(l.url,"_blank"),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Open URL"]}),e.jsx(he,{}),e.jsxs(R,{onClick:()=>r(l),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:()=>{P(l),m(!0)},className:"text-red-600",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}}],[r,m]),S=fe({data:M,columns:a,onSortingChange:v,onColumnFiltersChange:w,getCoreRowModel:Ne(),getPaginationRowModel:be(),getSortedRowModel:ye(),getFilteredRowModel:ve(),onColumnVisibilityChange:N,onRowSelectionChange:T,state:{sorting:f,columnFilters:u,columnVisibility:C,rowSelection:D}}),L=()=>{U&&s.mutate(U._id)};return t?e.jsx(K,{children:e.jsxs(V,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(k,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Failed to load popups"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"There was an error loading the popups data."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx(Se,{children:e.jsx(De,{children:"Popups"})}),e.jsx(V,{children:e.jsx(we,{table:S,columns:a,isLoading:A,searchKey:"title",searchPlaceholder:"Search by popup title..."})})]}),e.jsx(Ue,{open:!!n,onOpenChange:i=>m(!!i),handleConfirm:L,title:"Delete Popup",desc:`Are you sure you want to delete the popup "${U?.title}"? This action cannot be undone.`,confirmText:"Delete",cancelBtnText:"Cancel",isLoading:s.isPending,destructive:!0})]})}function Re(){const[r,c]=o.useState(null),[f,v]=o.useState(!1),u=C=>{c(C),v(!0)},w=()=>{v(!1),c(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Popups"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage promotional popups and announcements for your users."})]}),e.jsx(Me,{})]}),e.jsx(Ie,{onEdit:u}),e.jsx(Ae,{popup:r,isOpen:f,onClose:w})]})}const ls=()=>e.jsx(Re,{});export{ls as component};

import{r as o,j as e,B as j,c as he}from"./index-B9ijFU24.js";import{u as _,T as je,M as pe}from"./top-nav-U0iLahR3.js";import{C as p,a as f,b as N,d as g}from"./card-CG-QEZA1.js";import{B as x}from"./badge-D2S1lwUw.js";import{e as fe,s as Ne,C as ge,T as F,a as q,b as $}from"./analytics-api-Cuj6COlj.js";import{P as ve,a as ye,b as be}from"./popover-DEAxtLBY.js";import{S as we,a as Pe,b as Ce,c as De,d as v}from"./select-CEfwOxyw.js";import{T as ke,a as Me,b as X,c as l,d as Se,e as i}from"./table-C6TmOk5Z.js";import{H as Ie,S as Ee,T as Oe,C as Te,P as Ae}from"./config-drawer-CrK8Q9VY.js";import{C as z}from"./calendar-DdfZ3sSz.js";import{U as O,X as T,C as G}from"./sign-out-dialog-CHzf-qJM.js";import{c as M}from"./createLucideIcon-DuWw8G0_.js";import{P as V}from"./phone-Buzrv1l4.js";import{C as K,a as Q}from"./circle-x-CneMRj4B.js";import{f as d}from"./format-Dp3w_Y3x.js";import"./chevron-down-DQBvPwlq.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Le=M("circle-alert",Ue);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],A=M("clock",Re);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],He=M("dollar-sign",Be);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Z=M("mail",_e);function Fe(){const[r,J]=o.useState({from:Ne(new Date),to:fe(new Date)}),[P,W]=o.useState("all"),[Y,U]=o.useState(!1),[u,S]=o.useState(0),[c]=o.useState(10),[h,C]=o.useState(0),[m]=o.useState(10),D=d(r.from,"yyyy-MM-dd"),k=d(r.to,"yyyy-MM-dd"),{data:n,isLoading:y,refetch:ee}=_({queryKey:["new-premium-users",D,k,u,c],queryFn:()=>$.getNewPremiumUsers({startDate:D,endDate:k,limit:c,skip:u*c})}),{data:t,isLoading:b,refetch:se}=_({queryKey:["orders",P,D,k,h,m],queryFn:()=>$.getOrders({status:P==="all"?void 0:P,startDate:D,endDate:k,limit:m,skip:h*m})}),L=s=>new Intl.NumberFormat("en-US").format(s),w=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"UZS",minimumFractionDigits:0}).format(s),te=s=>{switch(s){case"PAID":return e.jsx(K,{className:"h-4 w-4 text-green-500"});case"PENDING":return e.jsx(A,{className:"h-4 w-4 text-yellow-500"});case"CANCELED":case"EXPIRED":return e.jsx(Q,{className:"h-4 w-4 text-red-500"});case"TIMEOUT":return e.jsx(Le,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(A,{className:"h-4 w-4 text-gray-500"})}},ae=s=>{switch(s){case"PAID":return"default";case"PENDING":return"secondary";case"CANCELED":case"EXPIRED":return"destructive";case"TIMEOUT":return"outline";default:return"outline"}},R=n?.data.results.reduce((s,a)=>s+a.count,0)||0,ne=n?.data.results.length||1,re=R/ne,I=n?.data.results.reduce((s,a)=>a.count>s.count?a:s,{date:"",count:0}),le=()=>{ee(),se()},ie=s=>{J(s),S(0),C(0)},de=()=>{S(s=>Math.max(0,s-1))},ce=()=>{n?.data.pagination?.hasMore&&S(s=>s+1)},me=()=>{C(s=>Math.max(0,s-1))},oe=()=>{t?.data.pagination?.hasMore&&C(s=>s+1)},B=s=>s.fullName?s.fullName:s.firstName?s.firstName:s.email?s.email.split("@")[0]:s.phone?s.phone:`User ${s.userId.slice(-6)}`,H=s=>s.fullName?s.fullName:s.firstName?s.firstName:s.displayName?s.displayName:s.email?s.email.split("@")[0]:s.phone?s.phone:`Order ${s.orderId.slice(-6)}`,xe=s=>s.email?{type:"email",value:s.email}:s.phone?{type:"phone",value:s.phone}:null,ue=s=>{W(s),C(0)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{children:[e.jsx(je,{links:qe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(Ee,{}),e.jsx(Oe,{}),e.jsx(Te,{}),e.jsx(Ae,{})]})]}),e.jsxs(pe,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Payments & Subscriptions"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Monitor premium subscriptions and payment transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(ve,{open:Y,onOpenChange:U,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:he("w-[300px] justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),r?`${d(r.from,"LLL dd, y")} - ${d(r.to,"LLL dd, y")}`:"Pick a date range"]})}),e.jsx(be,{className:"w-auto p-0",align:"start",children:e.jsx(ge,{initialFocus:!0,mode:"range",defaultMonth:r?.from,selected:r,onSelect:s=>{s?.from&&s?.to&&(ie({from:s.from,to:s.to}),U(!1))},numberOfMonths:2})})]}),e.jsx(j,{onClick:le,variant:"outline",disabled:y||b,children:y||b?"Refreshing...":"Refresh"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"New Premium Users"}),e.jsx(O,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:L(R)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"In selected date range"})]})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Daily Average"}),e.jsx(F,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:re.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"New users per day"})]})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Peak Day"}),e.jsx(z,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:I?.count||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:I?.date?d(new Date(I.date),"MMM dd"):"No data"})]})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Orders"}),e.jsx(T,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:L(t?.data.total||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"In selected range"})]})]})]}),e.jsxs(p,{className:"mb-6",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"New Premium Users Timeline"]}),n?.data.pagination&&e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:e.jsxs("span",{children:["Showing ",u*c+1,"-",Math.min((u+1)*c,n.data.pagination.total)," of ",n.data.pagination.total," days"]})})]}),e.jsxs(g,{children:[y?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 w-20 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-4 w-8 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-4 w-32 bg-muted animate-pulse rounded"})]},a))}):e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[n?.data.results.filter(s=>s.count>0).map(s=>e.jsxs("div",{className:"border-l-2 border-green-500 pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(x,{variant:"outline",className:"text-xs",children:d(new Date(s.date),"MMM dd, yyyy")}),e.jsxs(x,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",children:[s.count," new user",s.count!==1?"s":""]})]}),s.users.length>0&&e.jsx("div",{className:"space-y-2",children:s.users.map(a=>{const E=xe(a);return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:B(a)[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:B(a)}),E&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[E.type==="email"?e.jsx(Z,{className:"h-3 w-3"}):e.jsx(V,{className:"h-3 w-3"}),E.value]})]}),e.jsx(x,{variant:"outline",className:"text-xs",children:d(new Date(a.subscriptionStartDate),"HH:mm")})]},a._id)})})]},s.date)),n?.data.results.filter(s=>s.count>0).length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No new premium users in the selected date range"})]})]}),n?.data.pagination&&n.data.pagination.total>c&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",u+1," of ",Math.ceil(n.data.pagination.total/c)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:de,disabled:u===0||y,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:ce,disabled:!n.data.pagination.hasMore||y,children:["Next",e.jsx(G,{className:"h-4 w-4 ml-1"})]})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Payment Orders"]}),t?.data.total&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.data.total," total orders"]})]}),e.jsxs(we,{value:P,onValueChange:ue,children:[e.jsx(Pe,{className:"w-[150px]",children:e.jsx(Ce,{placeholder:"Filter by status"})}),e.jsxs(De,{children:[e.jsx(v,{value:"all",children:"All Orders"}),e.jsx(v,{value:"PENDING",children:"Pending"}),e.jsx(v,{value:"PAID",children:"Paid"}),e.jsx(v,{value:"CANCELED",children:"Canceled"}),e.jsx(v,{value:"TIMEOUT",children:"Timeout"}),e.jsx(v,{value:"EXPIRED",children:"Expired"})]})]})]}),e.jsxs(g,{children:[b?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-4 p-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-4 w-32 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-4 w-20 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-4 w-16 bg-muted animate-pulse rounded"})]},a))}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(ke,{children:[e.jsx(Me,{children:e.jsxs(X,{children:[e.jsx(l,{children:"Order ID"}),e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Contact"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Provider"}),e.jsx(l,{children:"Subscription"}),e.jsx(l,{children:"Date"})]})}),e.jsx(Se,{children:t?.data.orders.map(s=>e.jsxs(X,{children:[e.jsx(i,{className:"font-mono text-xs",children:s.orderId.slice(-8)}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:H(s)[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:H(s)}),s.promoCode&&e.jsx(x,{variant:"secondary",className:"text-xs mt-1",children:s.promoCode})]})]})}),e.jsx(i,{children:s.email?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm",children:s.email})]}):s.phone?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm",children:s.phone})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No contact"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:w(s.amount)}),s.discountAmount>0&&e.jsxs("div",{className:"text-xs text-green-600",children:["-",w(s.discountAmount)," discount"]}),s.paidAmount!==s.amount&&e.jsxs("div",{className:"text-xs text-blue-600",children:["Paid: ",w(s.paidAmount)]})]})}),e.jsx(i,{children:e.jsxs(x,{variant:ae(s.status),className:"flex items-center gap-1 w-fit",children:[te(s.status),s.status]})}),e.jsx(i,{children:e.jsx(x,{variant:"outline",children:s.provider})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:s.subscription}),s.hasPromo&&e.jsx(x,{variant:"secondary",className:"text-xs",children:"PROMO"})]})}),e.jsx(i,{className:"text-sm",children:d(new Date(s.date),"MMM dd, HH:mm")})]},s.orderId))})]}),t?.data.orders.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No orders found for the selected criteria"})]})]}),t?.data.pagination&&t.data.total>m&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",h*m+1,"-",Math.min((h+1)*m,t.data.total)," of ",t.data.total," orders"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:me,disabled:h===0||b,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",h+1," of ",Math.ceil(t.data.total/m)]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:oe,disabled:!t.data.pagination.hasMore||b,children:["Next",e.jsx(G,{className:"h-4 w-4 ml-1"})]})]})]}),t?.data.summary&&e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-3 lg:grid-cols-5",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx(He,{className:"h-4 w-4 mx-auto mb-1 text-green-500"}),e.jsx("div",{className:"font-medium text-sm",children:"Total Revenue"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:w(t.data.summary.totalRevenue)})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx(F,{className:"h-4 w-4 mx-auto mb-1 text-blue-500"}),e.jsx("div",{className:"font-medium text-sm",children:"Avg Order"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:w(t.data.summary.averageOrderValue)})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx(K,{className:"h-4 w-4 mx-auto mb-1 text-green-500"}),e.jsx("div",{className:"font-medium text-sm",children:"Paid"}),e.jsx("div",{className:"text-lg font-bold",children:t.data.summary.statusBreakdown.PAID||0})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx(A,{className:"h-4 w-4 mx-auto mb-1 text-yellow-500"}),e.jsx("div",{className:"font-medium text-sm",children:"Pending"}),e.jsx("div",{className:"text-lg font-bold",children:t.data.summary.statusBreakdown.PENDING||0})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded-lg",children:[e.jsx(Q,{className:"h-4 w-4 mx-auto mb-1 text-red-500"}),e.jsx("div",{className:"font-medium text-sm",children:"Failed"}),e.jsx("div",{className:"text-lg font-bold",children:(t.data.summary.statusBreakdown.CANCELED||0)+(t.data.summary.statusBreakdown.EXPIRED||0)+(t.data.summary.statusBreakdown.TIMEOUT||0)})]})]})]})]})]})]})}const qe=[{title:"Payments",href:"/payments",isActive:!0,disabled:!1},{title:"Revenue Analytics",href:"/payments/revenue",isActive:!1,disabled:!0},{title:"Subscription Plans",href:"/payments/plans",isActive:!1,disabled:!0}],rs=Fe;export{rs as component};
